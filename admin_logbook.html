<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Principal Logbook Report</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: navy;
      color: white;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background-color: navy;
      font-size: 1.2rem;
      font-weight: bold;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo img {
      height: 35px;
    }

    .btn {
      background-color: goldenrod;
      color: navy;
      border: none;
      padding: 10px 15px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      transition: 0.2s;
    }

    .btn:hover {
      background-color: #ffcc00;
    }

    .container {
      padding: 1rem;
    }

    .card {
      background-color: white;
      border-radius: 15px;
      padding: 1rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 13px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }

    th {
      background-color: #003366;
      color: white;
      position: relative;
    }

    tr:hover {
      background-color: #f5f5f5;
    }

    .filter-icon {
      cursor: pointer;
      font-size: 14px;
      float: right;
      margin-left: 8px;
    }

    .filter-menu {
      position: absolute;
      background: white;
      border: 1px solid #ddd;
      padding: 5px;
      z-index: 1000;
      max-height: 150px;
      overflow-y: auto;
      display: none;
      color: black;
    }

    .filter-menu select {
      width: 100%;
      padding: 5px;
    }

    @media (max-width: 768px) {
      table {
        font-size: 11px;
      }

      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="logo">
      <img src="1.png" alt="Alif Logo" />
      <span>Principal Logbook Report</span>
    </div>
    <div>
      <button class="btn" onclick="goToDashboard()">üè† Dashboard</button>
      <button class="btn" onclick="downloadPDF()">üìÑ Download PDF</button>
    </div>
  </div>

  <div class="container">
    <div class="card">
      <table id="logbookTable">
        <thead id="theadRow"></thead>
        <tbody id="tbodyRows"></tbody>
      </table>
    </div>
  </div>

  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby51sQL3xo9pIqc7WO6-gUCQhCpkL0JN-4HclaAWbjaRsDrUCD4gD7zc47PVSfn9A8jgA/exec"; // Replace with actual Google Apps Script URL
    let allData = [];
    let currentHeaders = [];

    // Fetch and load data
    fetch(WEB_APP_URL)
      .then(res => res.json())
      .then(data => {
        allData = data;
        currentHeaders = Object.keys(data[0]);
        renderTable(data);
      });

    function renderTable(data) {
      const thead = document.getElementById('theadRow');
      const tbody = document.getElementById('tbodyRows');
      thead.innerHTML = '';
      tbody.innerHTML = '';

      const tr = document.createElement('tr');
      currentHeaders.forEach((header, idx) => {
        const th = document.createElement('th');
        th.textContent = header;

        const icon = document.createElement('span');
        icon.textContent = 'üîç';
        icon.className = 'filter-icon';
        icon.onclick = () => showFilterMenu(header, idx, icon);

        th.appendChild(icon);
        tr.appendChild(th);
      });
      thead.appendChild(tr);

      data.forEach(row => {
        const tr = document.createElement('tr');
        currentHeaders.forEach(key => {
          const td = document.createElement('td');
          td.textContent = row[key];
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    function showFilterMenu(header, idx, iconEl) {
      closeAllFilters();

      const uniqueValues = [...new Set(allData.map(row => row[header]))];
      const menu = document.createElement('div');
      menu.className = 'filter-menu';

      const select = document.createElement('select');
      select.innerHTML = `<option value="">-- Show All --</option>`;
      uniqueValues.forEach(val => {
        const option = document.createElement('option');
        option.value = val;
        option.textContent = val;
        select.appendChild(option);
      });

      select.onchange = () => {
        const value = select.value;
        const filtered = value
          ? allData.filter(row => row[header] === value)
          : allData;
        renderTable(filtered);
        closeAllFilters();
      };

      menu.appendChild(select);
      iconEl.parentElement.appendChild(menu);
      menu.style.display = 'block';
    }

    function closeAllFilters() {
      document.querySelectorAll('.filter-menu').forEach(menu => menu.remove());
    }

    document.addEventListener('click', e => {
      if (!e.target.classList.contains('filter-icon') &&
          !e.target.closest('.filter-menu')) {
        closeAllFilters();
      }
    });

    // PDF Download
    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('l', 'pt', 'a4');
      doc.setFontSize(14);
      doc.text("Principal Logbook Report", 40, 30);
      doc.autoTable({
        html: '#logbookTable',
        startY: 50,
        theme: 'grid',
        styles: { fontSize: 8 }
      });
      doc.save("Logbook_Report.pdf");
    }

    // Dashboard redirect
    function goToDashboard() {
      window.location.href = "admin.html"; // Change to your dashboard URL
    }
  </script>
</body>
</html>
