<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Logbook Report - Alif Edu</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: navy;
      color: white;
    }

    .topbar {
      background-color: navy;
      padding: 1rem;
      text-align: center;
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .logo {
      height: 40px;
      vertical-align: middle;
      margin-right: 10px;
    }

    .container {
      padding: 1rem;
    }

    .card {
      background-color: white;
      color: black;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
      padding: 1rem;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 12px;
    }

    th {
      background-color: navy;
      color: white;
    }

    .filter-section {
      margin-bottom: 1rem;
      display: flex;
      gap: 10px;
      justify-content: space-between;
      align-items: center;
    }

    .filter-section select, .btn {
      padding: 10px;
      font-size: 14px;
      border-radius: 5px;
      border: none;
    }

    .btn {
      background-color: goldenrod;
      color: navy;
      font-weight: bold;
      cursor: pointer;
    }

    .btn:hover {
      background-color: #daa520;
    }

    .back-btn {
      margin-top: 20px;
    }

    @media screen and (max-width: 768px) {
      .filter-section {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <img src="1.png" class="logo" alt="Alif Logo">
    Logbook Report - Principal View
  </div>

  <div class="container">
    <div class="card">
      <!-- Filter Section: placed inside the card -->
      <div class="filter-section">
        <div>
          <select id="teacherFilter">
            <option value="">All Teachers</option>
          </select>
        </div>
        <div>
          <select id="monthFilter">
            <option value="">All Months</option>
            <option value="1">January</option>
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
            <option value="5">May</option>
            <option value="6">June</option>
            <option value="7">July</option>
            <option value="8">August</option>
            <option value="9">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
          </select>
        </div>
        <div>
          <button class="btn" onclick="applyFilter()">Apply Filter</button>
        </div>
      </div>

      <!-- Table Section -->
      <table id="logbookTable">
        <thead id="theadRow"></thead>
        <tbody id="tbodyRows"></tbody>
      </table>
    </div>

    <button class="btn back-btn" onclick="goBack()">← Back to Dashboard</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby51sQL3xo9pIqc7WO6-gUCQhCpkL0JN-4HclaAWbjaRsDrUCD4gD7zc47PVSfn9A8jgA/exec";
    let rawData = [];

    // Fetch the data from the Google Apps Script Web App URL
    fetch(WEB_APP_URL)
      .then(res => res.json())
      .then(data => {
        rawData = data;
        populateFilters(data);
        renderTable(data);  // Initially, render the full data
      });

    // Populate the teacher filter with unique names
    function populateFilters(data) {
      const teacherSet = new Set();
      data.forEach(row => teacherSet.add(row["Teacher’s Name"]));
      const teacherSelect = document.getElementById("teacherFilter");
      teacherSet.forEach(name => {
        const option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        teacherSelect.appendChild(option);
      });
    }

    // Apply the selected filters to the data and render the table
    function applyFilter() {
      const teacher = document.getElementById("teacherFilter").value;
      const month = document.getElementById("monthFilter").value;

      const filtered = rawData.filter(row => {
        let teacherMatch = teacher ? row["Teacher’s Name"].trim().toLowerCase() === teacher.trim().toLowerCase() : true;
        let monthMatch = true;
        if (month && row.Date) {
          const rowMonth = new Date(row.Date).getMonth() + 1;
          monthMatch = rowMonth == month;
        }
        return teacherMatch && monthMatch;
      });
      renderTable(filtered);
    }

    // Render the filtered data in the table
    function renderTable(data) {
      const thead = document.getElementById("theadRow");
      const tbody = document.getElementById("tbodyRows");
      thead.innerHTML = "";
      tbody.innerHTML = "";

      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="100%">No data found</td></tr>';
        return;
      }

      const headers = Object.keys(data[0]);
      const tr = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.innerText = h;
        tr.appendChild(th);
      });
      thead.appendChild(tr);

      data.forEach(row => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          td.innerText = row[h];
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    // Go back to the previous page (dashboard)
    function goBack() {
      window.history.back();
    }

    // Download the table as a PDF
    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('l', 'pt', 'a4');
      doc.setFontSize(14);
      doc.text("Logbook Report", 40, 30);
      doc.autoTable({ html: '#logbookTable', theme: 'grid', startY: 50, styles: { fontSize: 8 } });
      doc.save("Logbook_Report.pdf");
    }
  </script>
</body>
</html>
